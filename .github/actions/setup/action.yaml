name: Setup Action
description: Composite Setup Action

inputs:
  node-version:
    description: Node.js version
    required: false
    default: ''
  skip-rust-setup:
    description: Skip Rust setup
    required: false
    default: 'false'

runs:
  using: composite
  steps:
    - name: Setup pnpm
      uses: pnpm/action-setup@41ff72655975bd51cab0327fa583b6e92b6d3061 # v4.2.0
    - if: ${{ inputs.node-version == '' }}
      name: Setup Node.js
      uses: actions/setup-node@2028fbc5c25fe9cf00d9f06a71cc4710d4507903 # v6.0.0
      with:
        node-version-file: ./.node-version
        cache: pnpm
    - if: ${{ inputs.node-version != '' }}
      name: Setup Node.js v${{ inputs.node-version }}
      uses: actions/setup-node@2028fbc5c25fe9cf00d9f06a71cc4710d4507903 # v6.0.0
      with:
        node-version: ${{ inputs.node-version }}
        cache: pnpm
    - name: Install Dependencies
      run: |
        pnpm install --frozen-lockfile
        pnpm store prune
      shell: bash
    - name: Setup C++
      if: ${{ inputs.skip-rust-setup != 'true' }}
      run: |
        sudo apt-get update
        sudo apt-get install libstdc++-12-dev
      shell: bash
    - name: Setup Rust
      if: ${{ inputs.skip-rust-setup != 'true' }}
      uses: moonrepo/setup-rust@ede6de059f8046a5e236c94046823e2af11ca670 # v1.2.2
      with:
        targets: wasm32-unknown-unknown
        channel: nightly
        components: clippy,rustfmt
        target-dirs: web-csv-toolbox-wasm/target
    - name: Install wasm-pack
      if: ${{ inputs.skip-rust-setup != 'true' }}
      run: curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
      shell: bash
